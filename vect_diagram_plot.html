<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Векторная диаграмма ПЧ-АД</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(90deg, #4f6df5 0%, #2a36b0 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            padding: 30px;
        }

        @media (max-width: 1024px) {
            .content {
                grid-template-columns: 1fr;
            }
        }

        .input-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
        }

        .input-section h2 {
            color: #2a36b0;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #4f6df5;
            font-size: 1.8rem;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
        }

        .input-group input {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .input-group input:focus {
            outline: none;
            border-color: #4f6df5;
            box-shadow: 0 0 0 3px rgba(79, 109, 245, 0.1);
        }

        .input-group .unit {
            color: #6c757d;
            font-size: 0.8rem;
            margin-top: 3px;
        }

        .switch-group {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 12px;
            background: white;
            border-radius: 8px;
            border: 2px solid #dee2e6;
        }

        .switch-label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #4f6df5;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            flex: 1;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(90deg, #4f6df5 0%, #2a36b0 100%);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .plot-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
            height: fit-content;
        }

        .plot-section h2 {
            color: #2a36b0;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 3px solid #4f6df5;
            font-size: 1.8rem;
        }

        #plot {
            width: 100%;
            height: 700px;
            background: #f8f9fa;
            border-radius: 10px;
            border: 2px solid #dee2e6;
        }

        .results-section {
            grid-column: 1 / -1;
            background: white;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #e9ecef;
            margin-top: 20px;
        }

        .results-section h2 {
            color: #2a36b0;
            margin-bottom: 15px;
            font-size: 1.8rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .result-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4f6df5;
        }

        .result-item h3 {
            color: #495057;
            font-size: 0.9rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .result-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #2a36b0;
            font-family: 'Courier New', monospace;
        }

        .result-unit {
            color: #6c757d;
            font-size: 0.9rem;
            margin-left: 5px;
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            margin-top: 20px;
            padding-top: 15px;
            border-top: 2px solid #dee2e6;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
        }

        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin: 0 30px 20px;
            display: none;
            font-weight: 500;
        }

        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .instructions {
            grid-column: 1 / -1;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .instructions h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .instructions p {
            color: #856404;
            line-height: 1.5;
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .content {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .btn {
                padding: 10px 12px;
                font-size: 0.9rem;
            }
            
            #plot {
                height: 500px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Векторная диаграмма ПЧ-АД</h1>
            <p>Система "Преобразователь частоты - Асинхронный двигатель"</p>
        </div>

        <div class="alert" id="alert"></div>

        <div class="content">
            <div class="input-section">
                <h2>Параметры двигателя</h2>
                
                <div class="input-group">
                    <label>I1 - Ток статора (A)</label>
                    <input type="number" id="I1" step="0.01" value="9.27">
                    <div class="unit">А</div>
                </div>

                <div class="input-group">
                    <label>U1 - Напряжение статора (V)</label>
                    <input type="number" id="U1" step="1" value="200">
                    <div class="unit">В</div>
                </div>

                <div class="input-group">
                    <label>fi1 - Угол φ1 (°)</label>
                    <input type="number" id="fi1" step="0.1" value="49">
                    <div class="unit">°</div>
                </div>

                <div class="input-group">
                    <label>w - Скорость (рад/с)</label>
                    <input type="number" id="w" step="0.1" value="48.5">
                    <div class="unit">рад/с</div>
                </div>

                <div class="input-group">
                    <label>f - Частота (Гц)</label>
                    <input type="number" id="f" step="0.1" value="25">
                    <div class="unit">Гц</div>
                </div>

                <div class="input-group">
                    <label>Ip - Ток ротора (A)</label>
                    <input type="number" id="Ip" step="0.1" value="4.4">
                    <div class="unit">А</div>
                </div>

                <div class="input-group">
                    <label>r1 - Сопр. статора (Ом)</label>
                    <input type="number" id="r1" step="0.01" value="1.8">
                    <div class="unit">Ом</div>
                </div>

                <div class="input-group">
                    <label>x1 - Инд. статора (Ом)</label>
                    <input type="number" id="x1" step="0.01" value="2.33">
                    <div class="unit">Ом</div>
                </div>

                <div class="input-group">
                    <label>r2 - Сопр. ротора (Ом)</label>
                    <input type="number" id="r2" step="0.01" value="0.5">
                    <div class="unit">Ом</div>
                </div>

                <div class="input-group">
                    <label>x2 - Инд. ротора (Ом)</label>
                    <input type="number" id="x2" step="0.01" value="0.6">
                    <div class="unit">Ом</div>
                </div>

                <div class="input-group">
                    <label>xu - Инд. намагн. (Ом)</label>
                    <input type="number" id="xu" step="0.01" value="0.35">
                    <div class="unit">Ом</div>
                </div>

                <div class="input-group">
                    <label>Kr - Коэф. трансф.</label>
                    <input type="number" id="Kr" step="0.01" value="3.92">
                    <div class="unit">-</div>
                </div>

                <div class="switch-group">
                    <span class="switch-label">Расчет Iu (0-Starter, 1-расчет)</span>
                    <label class="switch">
                        <input type="checkbox" id="iupr">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="switch-group">
                    <span class="switch-label">Расчет I2 (0-построение, 1-расчет)</span>
                    <label class="switch">
                        <input type="checkbox" id="i2pr">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="buttons">
                    <button class="btn btn-primary" onclick="calculateAndPlot()">
                        Рассчитать и построить
                    </button>
                    <button class="btn btn-secondary" onclick="resetToDefaults()">
                        Сбросить
                    </button>
                </div>
            </div>

            <div class="plot-section">
                <h2>Векторная диаграмма</h2>
                <div id="plot"></div>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FF0000;"></div>
                        <span>U1</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #0000FF;"></div>
                        <span>I1</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #00FF00;"></div>
                        <span>I1r1</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #000000;"></div>
                        <span>U1'</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FF00FF;"></div>
                        <span>E1</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #008000;"></div>
                        <span>Iu</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #800080;"></div>
                        <span>I2'</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #FFFF00;"></div>
                        <span>I2'x2'</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background-color: #00FFFF;"></div>
                        <span>U2'</span>
                    </div>
                </div>
            </div>

            <div class="results-section">
                <h2>Результаты расчетов</h2>
                <div class="results-grid" id="results"></div>
            </div>

            <div class="instructions">
                <h3>Инструкция:</h3>
                <p>1. Введите параметры двигателя в левой панели</p>
                <p>2. Выберите метод расчета для токов Iu и I2'</p>
                <p>3. Нажмите "Рассчитать и построить" для визуализации</p>
                <p>4. Векторная диаграмма показывает замкнутые контуры напряжений и токов</p>
            </div>
        </div>
    </div>

    <script>
        // Класс для комплексных чисел
        class Complex {
            constructor(re, im) {
                this.re = re;
                this.im = im;
            }
            
            static fromPolar(r, theta) {
                return new Complex(r * Math.cos(theta), r * Math.sin(theta));
            }
            
            abs() {
                return Math.sqrt(this.re * this.re + this.im * this.im);
            }
            
            angle() {
                return Math.atan2(this.im, this.re);
            }
            
            add(c) {
                return new Complex(this.re + c.re, this.im + c.im);
            }
            
            sub(c) {
                return new Complex(this.re - c.re, this.im - c.im);
            }
            
            mul(c) {
                return new Complex(
                    this.re * c.re - this.im * c.im,
                    this.re * c.im + this.im * c.re
                );
            }
            
            mulScalar(k) {
                return new Complex(this.re * k, this.im * k);
            }
            
            div(c) {
                const denom = c.re * c.re + c.im * c.im;
                return new Complex(
                    (this.re * c.re + this.im * c.im) / denom,
                    (this.im * c.re - this.re * c.im) / denom
                );
            }
            
            conj() {
                return new Complex(this.re, -this.im);
            }
            
            rotate(angle) {
                const r = this.abs();
                const theta = this.angle() + angle;
                return Complex.fromPolar(r, theta);
            }
        }

        // Функция отображения сообщений
        function showAlert(message, type = 'error') {
            const alertDiv = document.getElementById('alert');
            alertDiv.textContent = message;
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000);
        }

        // Сброс к исходным значениям
        function resetToDefaults() {
            document.getElementById('I1').value = '9.27';
            document.getElementById('U1').value = '200';
            document.getElementById('fi1').value = '49';
            document.getElementById('w').value = '48.5';
            document.getElementById('f').value = '25';
            document.getElementById('Ip').value = '4.4';
            document.getElementById('r1').value = '1.8';
            document.getElementById('x1').value = '2.33';
            document.getElementById('r2').value = '0.5';
            document.getElementById('x2').value = '0.6';
            document.getElementById('xu').value = '0.35';
            document.getElementById('Kr').value = '3.92';
            document.getElementById('iupr').checked = false;
            document.getElementById('i2pr').checked = false;
            
            calculateAndPlot();
            showAlert('Значения сброшены', 'success');
        }

        // Основная функция расчета
        function calculateAndPlot() {
            try {
                // Получение входных данных
                const I1_val = parseFloat(document.getElementById('I1').value);
                const U1_val = parseFloat(document.getElementById('U1').value);
                const fi1_val = parseFloat(document.getElementById('fi1').value);
                const w_val = parseFloat(document.getElementById('w').value);
                const f_val = parseFloat(document.getElementById('f').value);
                const Ip_val = parseFloat(document.getElementById('Ip').value);
                const r1_val = parseFloat(document.getElementById('r1').value);
                const x1_val = parseFloat(document.getElementById('x1').value);
                const r2_val = parseFloat(document.getElementById('r2').value);
                const x2_val = parseFloat(document.getElementById('x2').value);
                const xu_val = parseFloat(document.getElementById('xu').value);
                const Kr_val = parseFloat(document.getElementById('Kr').value);
                const iupr = document.getElementById('iupr').checked ? 1 : 0;
                const i2pr = document.getElementById('i2pr').checked ? 1 : 0;

                // Проверка данных
                const inputs = [I1_val, U1_val, fi1_val, w_val, f_val, Ip_val, 
                              r1_val, x1_val, r2_val, x2_val, xu_val, Kr_val];
                if (inputs.some(isNaN)) {
                    throw new Error('Все поля должны быть заполнены числами');
                }

                // Константы и преобразования
                const deg = Math.PI / 180;
                const j = new Complex(0, 1);
                
                // Расчетные параметры
                const W0n = 2 * Math.PI * 50 / 3;  // Синхронная скорость при 50 Гц
                const al = f_val / 50;             // Относительная частота
                const W0 = al * W0n;               // Синхронная скорость
                const Ke = Math.sqrt(Kr_val);      // Коэф. трансформации по ЭДС
                const s = (W0 - w_val) / W0;       // Скольжение
                const r2p = r2_val * Kr_val;       // Приведенное сопротивление ротора
                const x2p = x2_val * Kr_val;       // Приведенное индуктивное сопротивление

                // Вектор U1 (направлен по оси +Y)
                const U1 = Complex.fromPolar(U1_val, Math.PI/2);
                
                // Вектор I1 (отстает от U1 на угол fi1)
                const I1 = Complex.fromPolar(I1_val, Math.PI/2 - fi1_val * deg);
                
                // Падение напряжения на r1 (I1 * r1, сонаправлено с I1)
                const I1r1 = I1.mulScalar(r1_val);
                
                // Падение напряжения на x1 (I1 * j * x1 * al, опережает I1 на 90°)
                const I1x1 = I1.mul(j).mulScalar(x1_val * al);
                
                // Напряжение U1' = U1 - I1r1
                const U1p = U1.sub(I1r1);
                
                // ЭДС E1 = U1 - I1r1 - I1x1
                const E1 = U1.sub(I1r1).sub(I1x1);
                
                // Расчет тока намагничивания Iu
                let Iu;
                if (iupr === 0) {
                    // Значение из Starter
                    Iu = Complex.fromPolar(8, E1.angle() - Math.PI/2);
                } else {
                    // Расчетное значение
                    const Zu = new Complex(0, xu_val * al);
                    Iu = E1.div(Zu);
                }
                
                // Расчет тока ротора I2'
                let I2p;
                if (i2pr === 0) {
                    // По построению: I2' = Iu - I1
                    I2p = Iu.sub(I1);
                } else {
                    // По расчету
                    const Z2p = new Complex(r2p/s, x2p * al);
                    I2p = E1.div(Z2p);
                }
                
                // Падение напряжения на x2' (I2' * j * x2')
                const I2px2p = I2p.mul(j).mulScalar(x2p * al);
                
                // Напряжение на роторе U2' = E1 + I2' * j * x2'
                const U2p = E1.add(I2px2p);

                // Проверка замкнутости контуров
                // 1. Контур напряжений: U1 = I1r1 + I1x1 + E1
                const sum1 = I1r1.add(I1x1).add(E1);
                const diff1 = U1.sub(sum1).abs();
                
                // 2. Контур токов: I1 + I2' = Iu
                const sum2 = I1.add(I2p);
                const diff2 = Iu.sub(sum2).abs();
                
                // 3. Контур ротора: E1 + I2px2p = U2p
                const sum3 = E1.add(I2px2p);
                const diff3 = U2p.sub(sum3).abs();

                // Подготовка данных для графика
                const vectors = [
                    // Основные векторы из нуля
                    { name: 'U1', start: [0, 0], end: [U1.re, U1.im], color: '#FF0000', width: 3 },
                    { name: 'I1', start: [0, 0], end: [I1.re * 10, I1.im * 10], color: '#0000FF', width: 2 }, // Масштаб для токов
                    { name: 'U1\'', start: [0, 0], end: [U1p.re, U1p.im], color: '#000000', width: 2 },
                    { name: 'E1', start: [0, 0], end: [E1.re, E1.im], color: '#FF00FF', width: 2 },
                    { name: 'Iu', start: [0, 0], end: [Iu.re * 10, Iu.im * 10], color: '#008000', width: 2 },
                    { name: 'U2\'', start: [0, 0], end: [U2p.re, U2p.im], color: '#00FFFF', width: 2 },
                    
                    // Векторы падений напряжений
                    { name: 'I1r1', start: [U1.re, U1.im], end: [U1p.re, U1p.im], color: '#00FF00', width: 2, dash: 'dash' },
                    { name: 'I1x1', start: [U1p.re, U1p.im], end: [E1.re, E1.im], color: '#FFA500', width: 2, dash: 'dot' },
                    
                    // Вектор тока ротора (от конца I1 до конца Iu)
                    { name: 'I2\'', start: [I1.re * 10, I1.im * 10], end: [Iu.re * 10, Iu.im * 10], color: '#800080', width: 2 },
                    
                    // Падение напряжения на x2'
                    { name: 'I2\'x2\'', start: [E1.re, E1.im], end: [U2p.re, U2p.im], color: '#FFFF00', width: 2, dash: 'dashdot' }
                ];

                // Создание трасс для Plotly
                const traces = [];
                
                // Добавляем векторы как стрелки
                vectors.forEach(vec => {
                    // Основная линия вектора
                    traces.push({
                        x: [vec.start[0], vec.end[0]],
                        y: [vec.start[1], vec.end[1]],
                        mode: 'lines',
                        name: vec.name,
                        line: {
                            color: vec.color,
                            width: vec.width,
                            dash: vec.dash || 'solid'
                        },
                        hoverinfo: 'name+x+y',
                        showlegend: true
                    });
                    
                    // Стрелка на конце вектора
                    const dx = vec.end[0] - vec.start[0];
                    const dy = vec.end[1] - vec.start[1];
                    const length = Math.sqrt(dx*dx + dy*dy);
                    if (length > 0.1) {
                        const arrowLength = Math.min(5, length * 0.1);
                        const angle = Math.atan2(dy, dx);
                        
                        // Левая часть стрелки
                        const arrowLeft = {
                            x: [vec.end[0], vec.end[0] - arrowLength * Math.cos(angle + Math.PI/6)],
                            y: [vec.end[1], vec.end[1] - arrowLength * Math.sin(angle + Math.PI/6)],
                            mode: 'lines',
                            line: { color: vec.color, width: vec.width },
                            showlegend: false,
                            hoverinfo: 'skip'
                        };
                        
                        // Правая часть стрелки
                        const arrowRight = {
                            x: [vec.end[0], vec.end[0] - arrowLength * Math.cos(angle - Math.PI/6)],
                            y: [vec.end[1], vec.end[1] - arrowLength * Math.sin(angle - Math.PI/6)],
                            mode: 'lines',
                            line: { color: vec.color, width: vec.width },
                            showlegend: false,
                            hoverinfo: 'skip'
                        };
                        
                        traces.push(arrowLeft, arrowRight);
                    }
                });

                // Точки для подписей
                const points = [
                    { name: 'U1', x: U1.re/2, y: U1.im/2, color: '#FF0000' },
                    { name: 'I1', x: I1.re*5, y: I1.im*5, color: '#0000FF' },
                    { name: 'I1r1', x: (U1.re + U1p.re)/2, y: (U1.im + U1p.im)/2, color: '#00FF00' },
                    { name: 'U1\'', x: U1p.re/2, y: U1p.im/2, color: '#000000' },
                    { name: 'I1x1', x: (U1p.re + E1.re)/2, y: (U1p.im + E1.im)/2, color: '#FFA500' },
                    { name: 'E1', x: E1.re/2, y: E1.im/2, color: '#FF00FF' },
                    { name: 'Iu', x: Iu.re*5, y: Iu.im*5, color: '#008000' },
                    { name: 'I2\'', x: (I1.re*10 + Iu.re*10)/2, y: (I1.im*10 + Iu.im*10)/2, color: '#800080' },
                    { name: 'I2\'x2\'', x: (E1.re + U2p.re)/2, y: (E1.im + U2p.im)/2, color: '#FFFF00' },
                    { name: 'U2\'', x: U2p.re/2, y: U2p.im/2, color: '#00FFFF' }
                ];

                // Добавляем точки для подписей
                points.forEach(pt => {
                    traces.push({
                        x: [pt.x],
                        y: [pt.y],
                        mode: 'text',
                        text: [pt.name],
                        textfont: {
                            color: pt.color,
                            size: 12,
                            family: 'Arial'
                        },
                        showlegend: false,
                        hoverinfo: 'skip'
                    });
                });

                // Настройка графика
                const maxVal = Math.max(
                    Math.abs(U1.re), Math.abs(U1.im),
                    Math.abs(U1p.re), Math.abs(U1p.im),
                    Math.abs(E1.re), Math.abs(E1.im),
                    Math.abs(U2p.re), Math.abs(U2p.im),
                    Math.abs(I1.re*10), Math.abs(I1.im*10),
                    Math.abs(Iu.re*10), Math.abs(Iu.im*10)
                ) * 1.2;

                const layout = {
                    title: {
                        text: 'Векторная диаграмма ПЧ-АД',
                        font: { size: 20 }
                    },
                    xaxis: {
                        title: 'Действительная ось',
                        range: [-maxVal, maxVal],
                        scaleanchor: 'y',
                        scaleratio: 1,
                        zeroline: true,
                        gridcolor: '#eee'
                    },
                    yaxis: {
                        title: 'Мнимая ось',
                        range: [-maxVal, maxVal],
                        zeroline: true,
                        gridcolor: '#eee'
                    },
                    showlegend: true,
                    legend: {
                        x: 1.05,
                        y: 1,
                        xanchor: 'left',
                        bgcolor: 'rgba(255,255,255,0.8)'
                    },
                    paper_bgcolor: '#f8f9fa',
                    plot_bgcolor: '#f8f9fa',
                    hovermode: 'closest',
                    width: 800,
                    height: 700,
                    margin: { l: 80, r: 150, b: 80, t: 80, pad: 10 }
                };

                // Отрисовка графика
                Plotly.newPlot('plot', traces, layout, {
                    responsive: true,
                    displayModeBar: true,
                    displaylogo: false
                });

                // Обновление результатов
                updateResults({
                    s: s.toFixed(4),
                    al: al.toFixed(3),
                    W0: W0.toFixed(1),
                    W0n: W0n.toFixed(1),
                    r2p: r2p.toFixed(3),
                    x2p: x2p.toFixed(3),
                    E1: E1.abs().toFixed(1),
                    U1: U1.abs().toFixed(1),
                    U1p: U1p.abs().toFixed(1),
                    U2p: U2p.abs().toFixed(1),
                    I1: I1.abs().toFixed(2),
                    Iu: Iu.abs().toFixed(2),
                    I2p: I2p.abs().toFixed(2),
                    diff1: diff1.toFixed(3),
                    diff2: diff2.toFixed(3),
                    diff3: diff3.toFixed(3)
                });

                showAlert('Расчет выполнен успешно! Контуры замкнуты.', 'success');

            } catch (error) {
                showAlert(`Ошибка: ${error.message}`);
                console.error(error);
            }
        }

        // Обновление результатов
        function updateResults(results) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <div class="result-item">
                    <h3>Скольжение s</h3>
                    <div class="result-value">${results.s}<span class="result-unit"></span></div>
                </div>
                <div class="result-item">
                    <h3>Относительная частота α</h3>
                    <div class="result-value">${results.al}<span class="result-unit"></span></div>
                </div>
                <div class="result-item">
                    <h3>Синхронная скорость ω₀</h3>
                    <div class="result-value">${results.W0}<span class="result-unit"> рад/с</span></div>
                </div>
                <div class="result-item">
                    <h3>ЭДС E₁</h3>
                    <div class="result-value">${results.E1}<span class="result-unit"> В</span></div>
                </div>
                <div class="result-item">
                    <h3>Напряжение U₁'</h3>
                    <div class="result-value">${results.U1p}<span class="result-unit"> В</span></div>
                </div>
                <div class="result-item">
                    <h3>Напряжение U₂'</h3>
                    <div class="result-value">${results.U2p}<span class="result-unit"> В</span></div>
                </div>
                <div class="result-item">
                    <h3>Ток I₁</h3>
                    <div class="result-value">${results.I1}<span class="result-unit"> А</span></div>
                </div>
                <div class="result-item">
                    <h3>Ток Iᵤ</h3>
                    <div class="result-value">${results.Iu}<span class="result-unit"> А</span></div>
                </div>
                <div class="result-item">
                    <h3>Ток I₂'</h3>
                    <div class="result-value">${results.I2p}<span class="result-unit"> А</span></div>
                </div>
                <div class="result-item">
                    <h3>Погрешность контура 1</h3>
                    <div class="result-value">${results.diff1}<span class="result-unit"> В</span></div>
                </div>
                <div class="result-item">
                    <h3>Погрешность контура 2</h3>
                    <div class="result-value">${results.diff2}<span class="result-unit"> А</span></div>
                </div>
                <div class="result-item">
                    <h3>Погрешность контура 3</h3>
                    <div class="result-value">${results.diff3}<span class="result-unit"> В</span></div>
                </div>
            `;
        }

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            calculateAndPlot();
            
            // Динамическое обновление
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('change', calculateAndPlot);
            });
            
            document.querySelectorAll('.switch input').forEach(checkbox => {
                checkbox.addEventListener('change', calculateAndPlot);
            });
        });
    </script>
</body>
</html>